<!DOCTYPE html>
<html lang="es">
	<head>
		<title>Proyecto</title>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
		<link rel="shortcut icon" href="#">
        <script src= './js/keyboard.js'> </script>
		<script src='js/stats.min.js'></script>
        <style>
			.label {
				color: rgb(255, 255, 255);
				font-family: sans-serif;
				padding: 2px;
				font-size: small;
				background: rgba(116, 7, 7, 0.6);
			}
		</style>
	</head>
    
	<body>


		<script type="module">

			import * as THREE from './three/build/three.module.js';

			
			import { VRButton } from './three/examples/jsm/webxr/VRButton.js';
			import { OrbitControls } from './three/examples/jsm/controls/OrbitControls.js'
			import { CSS2DRenderer, CSS2DObject } from './three/examples/jsm/renderers/CSS2DRenderer.js';
			
			

			const clock = new THREE.Clock();
			
			
			let container;
			let camera, topCamera, scene, raycaster, renderer, stats, mainMover, deltaTime, totalTime, labelRenderer;
			var keyboard;
			var sunObject, mercuryObject, venusObject, earthObject, moonObject, marsObject, jupiterObject, anillosObject, object;
			var anillosObject2, saturnoObject, uranoObject, neptunoObject;
			var pointer, controls;

			const group = new THREE.Group();
            const user = new THREE.Object3D();
			const pointLight = new THREE.PointLight( 0xf0f0f0,2, 80);
			let INTERSECTED;
			

			const moonDiv = document.createElement( 'div' );
			moonDiv.className = 'label';
			moonDiv.setAttribute('style', 'white-space: pre;');
			moonDiv.textContent = 'Luna / KILLA\r\n Masa: 7,349 × 1022 kg\r\n Gravedad: 1.62 m/s²';
			moonDiv.style.marginTop = '-1em';
			
			const sunDiv = document.createElement( 'div' );
			sunDiv.className = 'label';
			sunDiv.setAttribute('style', 'white-space: pre;');
			sunDiv.textContent = "            Sol / INTI\r\n Masa: 1.989 × 10^30 kg\r\n Gravedad: 274 m/s²";
			sunDiv.style.marginTop = '-1em';
			
			const mercuryDiv = document.createElement( 'div' );
			mercuryDiv.className = 'label';
			mercuryDiv.setAttribute('style', 'white-space: pre;');
			mercuryDiv.textContent = 'Mercurio / RIMSI\r\n Masa: 3.285 × 10^23 kg\r\n Gravedad: 3.7 m/s²';
			mercuryDiv.style.marginTop = '-1em';

			const venusDiv = document.createElement( 'div' );
			venusDiv.className = 'label';
			venusDiv.setAttribute('style', 'white-space: pre;');
			venusDiv.textContent = 'Venus / CHASKA\r\n Masa: 4.867 × 10^24 kg\r\n Gravedad: 8.87 m/s²';
			venusDiv.style.marginTop = '-1em';

			const earthDiv = document.createElement( 'div' );
			earthDiv.className = 'label';
			earthDiv.setAttribute('style', 'white-space: pre;');
			earthDiv.textContent = 'Tierra / PACHA\r\n Masa: 5.972 × 10^24 kg\r\n Gravedad: 9.807 m/s²';
			earthDiv.style.marginTop = '-1em';
			
			const marsDiv = document.createElement( 'div' );
			marsDiv.className = 'label';
			marsDiv.setAttribute('style', 'white-space: pre;');
			marsDiv.textContent = 'Marte / AWQAKUQ\r\n Masa: 5.972 × 10^24 kg\r\n Gravedad: 3.721 m/s²';
			marsDiv.style.marginTop = '-1em';

			const jupiterDiv = document.createElement( 'div' );
			jupiterDiv.className = 'label';
			jupiterDiv.setAttribute('style', 'white-space: pre;');
			jupiterDiv.textContent = 'Jupiter / PIRWA\r\n Masa: 1.898 × 10^27 kg\r\n Gravedad: 24.79 m/s²';
			jupiterDiv.style.marginTop = '-1em';

			const saturnoDiv = document.createElement( 'div' );
			saturnoDiv.className = 'label';
			saturnoDiv.setAttribute('style', 'white-space: pre;');
			saturnoDiv.textContent = 'Saturno / HAWCHA\r\n Masa: 5.683 × 10^26 kg\r\n Gravedad: 10.44 m/s²';
			saturnoDiv.style.marginTop = '-1em';

			const uranoDiv = document.createElement( 'div' );
			uranoDiv.className = 'label';
			uranoDiv.setAttribute('style', 'white-space: pre;');
			uranoDiv.textContent = 'Urano / RITI\r\n Masa: 8.681 × 10^25 kg \r\n Gravedad: 8.87 m/s²';
			uranoDiv.style.marginTop = '-1em';

			const neptunoDiv = document.createElement( 'div' );
			neptunoDiv.className = 'label';
			neptunoDiv.setAttribute('style', 'white-space: pre;');
			neptunoDiv.textContent = 'Neptuno / TINKULLPA\r\n Masa: 1.024 × 10^26 kg\r\n Gravedad: 11.15 m/s²';
			neptunoDiv.style.marginTop = '-1em';

			
			const moonLabel = new CSS2DObject( moonDiv );
			const sunLabel = new CSS2DObject( sunDiv );
			const mercuryLabel = new CSS2DObject( mercuryDiv );
			const venusLabel = new CSS2DObject( venusDiv );
			const earthLabel = new CSS2DObject( earthDiv );
			const marsLabel = new CSS2DObject( marsDiv );
			const jupiterLabel = new CSS2DObject( jupiterDiv );
			const saturnoLabel = new CSS2DObject( saturnoDiv );
			const uranoLabel = new CSS2DObject( uranoDiv );
			const neptunoLabel = new CSS2DObject( neptunoDiv );



			init();
			animate();

			function init() {

				const geometry23 = new THREE.SphereGeometry( 500, 60, 40 );
				// invert the geometry on the x-axis so that all of the faces point inward
				geometry23.scale( - 1, 1, 1 );
				const texture = new THREE.TextureLoader().load('./images/universe.png');
				const mesh = new THREE.MeshBasicMaterial({map: texture});
				const fondo = new THREE.Mesh( geometry23, mesh );

				container = document.createElement( 'div' );
				document.body.appendChild( container );

				scene = new THREE.Scene();
				
				scene.add(fondo);
                
				raycaster = new THREE.Raycaster();
  				pointer = new THREE.Vector2()

				camera = new THREE.PerspectiveCamera( 60, window.innerWidth / window.innerHeight, 1, 2000 );
				camera.position.set( 0, 4, 17 );
                camera.lookAt(scene.position);
				scene.add( camera );

				pointLight.position.set(0,0,0);
				scene.add(pointLight);
				
				
                
				deltaTime = 0;
				totalTime = 0;

				keyboard = new Keyboard();
				stats = new Stats();
				document.body.appendChild( stats.dom );

                let loader = new THREE.TextureLoader();

                let sun = new THREE.MeshPhongMaterial({map: loader.load("images/sun.png"), side: THREE.BackSide})
				let mercury = new THREE.MeshPhongMaterial({map: loader.load("images/mercury.png"), side: THREE.DoubleSide})
				let venus = new THREE.MeshPhongMaterial({map: loader.load("images/venus.png"), side: THREE.DoubleSide})
				let earth = new THREE.MeshPhongMaterial({map: loader.load("images/earth.png"), side: THREE.DoubleSide})
				let moon = new THREE.MeshPhongMaterial({map: loader.load("images/moon.png"), side: THREE.DoubleSide})
				let mars = new THREE.MeshPhongMaterial({map: loader.load("images/mars.png"), side: THREE.DoubleSide})
				let jupiter = new THREE.MeshPhongMaterial({map: loader.load("images/jupiter.png"), side: THREE.DoubleSide})
				let saturno = new THREE.MeshPhongMaterial({map: loader.load("images/saturno.png"), side: THREE.DoubleSide})
				let materialanillos = new THREE.MeshPhongMaterial( {map: loader.load("images/ring.png"), side: THREE.DoubleSide} );
				let urano = new THREE.MeshPhongMaterial( {map: loader.load("images/urano.png"), side: THREE.DoubleSide} );
				let neptuno = new THREE.MeshPhongMaterial( {map: loader.load("images/neptuno.png"), side: THREE.DoubleSide} );
				
				//let materialanillos = new THREE.MeshPhongMaterial( { color: 0xFFFFFF } );
				
				let luz = new THREE.HemisphereLight( 0xffffff, 0xffffff, 1 );
				luz.position.set(0,0,0);
				scene.add( luz );

				let defaultMaterial = new THREE.MeshBasicMaterial({
					map: loader.load("images/sphere-colored.png"), 
					color: 0x444444,
					side: THREE.DoubleSide,
					transparent: true
				});

				
                var geometrySun = new THREE.SphereGeometry( 3, 32, 32 );
                sunObject = new THREE.Mesh( geometrySun, sun );
                sunObject.position.x = 0;
                sunObject.position.y = 0;
                sunObject.position.z = 0;
				scene.add(sunObject);

                var geometryMercury = new THREE.SphereGeometry( 0.2, 32, 32 );
				mercuryObject = new THREE.Mesh(geometryMercury, mercury);
				mercuryObject.position.x = 2;
				mercuryObject.position.y = 0;
				mercuryObject.position.z = 0;
				scene.add(mercuryObject);

				var geometryVenus = new THREE.SphereGeometry( 0.4, 32, 32 );
				venusObject = new THREE.Mesh(geometryVenus, venus);
				venusObject.position.x = 4;
				venusObject.position.y = 0;
				venusObject.position.z = 0;
				scene.add(venusObject);

				var geometryEarth = new THREE.SphereGeometry( 0.6, 32, 32 );
				earthObject = new THREE.Mesh(geometryEarth, earth);
				earthObject.position.x = 6;
				earthObject.position.y = 0;
				earthObject.position.z = 4;
				scene.add(earthObject);

				var geometrymoon = new THREE.SphereGeometry( 0.10, 32, 32 );
				moonObject = new THREE.Mesh(geometrymoon, moon);
				moonObject.position.x = 6
				moonObject.position.y = 0;
				moonObject.position.z = 4;
				scene.add(moonObject);

				var geometryMars = new THREE.SphereGeometry( 0.55, 32, 32 );
				marsObject = new THREE.Mesh(geometryMars, mars);
				marsObject.position.x = 6;
				marsObject.position.y = 0;
				marsObject.position.z = 0;
				scene.add(marsObject);

				var geometryJupiter = new THREE.SphereGeometry( 1.5, 32, 32 );
				jupiterObject = new THREE.Mesh(geometryJupiter, jupiter);
				jupiterObject.position.x = 12;
				jupiterObject.position.y = 0;
				jupiterObject.position.z = 0;
				scene.add(jupiterObject);

				var geometrySaturno = new THREE.SphereGeometry( 1.5, 32, 32 );
				saturnoObject = new THREE.Mesh(geometrySaturno, saturno);
				saturnoObject.position.x = 12;
				saturnoObject.position.y = 0;
				saturnoObject.position.z = 0;
				scene.add(saturnoObject);

				const geometryanillos = new THREE.TorusGeometry( 2, 0.3, 2, 200 );
				anillosObject = new THREE.Mesh( geometryanillos, materialanillos );
				anillosObject.rotateX(0.7);
				scene.add( anillosObject );

				const geometryanillos2 = new THREE.TorusGeometry( 2.6, 0.3, 2, 200 );
				anillosObject2 = new THREE.Mesh( geometryanillos2, materialanillos );
				anillosObject2.rotateX(0.7);
				scene.add( anillosObject2 );


				var geometryUrano = new THREE.SphereGeometry( 1.5, 32, 32 );
				uranoObject = new THREE.Mesh(geometryUrano, urano);
				uranoObject.position.x = 12;
				uranoObject.position.y = 0;
				uranoObject.position.z = 0;
				scene.add(uranoObject);

				var geometryNeptuno = new THREE.SphereGeometry( 1.5, 32, 32 );
				neptunoObject = new THREE.Mesh(geometryNeptuno, neptuno);
				neptunoObject.position.x = 12;
				neptunoObject.position.y = 0;
				neptunoObject.position.z = 0;
				scene.add(neptunoObject);

				sunLabel.position.set( 0, 0, 0 );
				mercuryLabel.position.set( 0, 0, 0 );
				venusLabel.position.set( 0, 0, 0 );
				earthLabel.position.set( 0, 0, 0 );
				moonLabel.position.set( 0, 0, 0 );
				marsLabel.position.set( 0, 0, 0 );
                
				
				var meteoritos=["./images/roca.jpg","./images/meteoro.jpg", "./images/meteoro2.jpg","./images/meteoro3.jpg"]
				
				var num = 0.01;

				for ( let i = 0; i < 300; i ++ ) {
					var tam= Math.random()*0.2;
					var tam2= Math.random() * (5 -3) + 3;
					var tam3= Math.random() * (5 -3) + 3;

					const meteoros = new THREE.SphereGeometry( tam, tam2, tam3 );
					const texturamdom = Math.floor(Math.random() * meteoritos.length);

					const object = new THREE.Mesh( meteoros, new THREE.MeshPhongMaterial({map: loader.load(meteoritos[texturamdom]), side: THREE.DoubleSide} ) );
					
					var pos = Math.random() * (20 - 15) + 15;
					object.position.x = Math.random() < 0.5 ? -pos*Math.sin(num) :  pos*Math.sin(num);
					object.position.y = 0;
					object.position.z = Math.random() < 0.5 ? -pos*Math.cos(num) : pos*Math.cos(num);
					num = num +1.5;
					
					var velo = Math.random(0.90)/100;
					
					object.rotation.y += velo;

					group.add( object );
					
				}
                
                
				sunObject.add(group);
				scene.add(group);
				
				let mainCameraMesh = new THREE.Mesh( 
					new THREE.BoxGeometry(1,1,1), 
					new THREE.MeshBasicMaterial({
						color: 0xff00ff
					}) 
				);
				mainMover = new THREE.Group();
				mainMover.position.set(0, 3, 0);
				mainMover.add( camera );
				scene.add( mainMover );
				
				renderer = new THREE.WebGLRenderer( { antialias: true } );
				renderer.setPixelRatio( window.devicePixelRatio );
				renderer.setSize( window.innerWidth, window.innerHeight );
				renderer.outputEncoding = THREE.sRGBEncoding;
				renderer.xr.enabled = true;
				container.appendChild( renderer.domElement )

				window.addEventListener( 'resize', onWindowResize );
				document.addEventListener( 'mousemove', onPointerMove );
				document.body.appendChild( VRButton.createButton( renderer ) );

				labelRenderer = new CSS2DRenderer();
				labelRenderer.setSize( window.innerWidth, window.innerHeight );
				labelRenderer.domElement.style.position = 'absolute';
				labelRenderer.domElement.style.top = '0px';
				document.body.appendChild( labelRenderer.domElement );
				
				//LabelRenderer nos da como otra capa de render es por eso que usamos esta manera
				controls = new OrbitControls( camera, labelRenderer.domElement );
                
			}

			function updateLight() {
				pointLight.updateMatrixWorld();
			}
				 
			function onPointerMove( event ) {

			pointer.x = ( event.clientX / window.innerWidth ) * 2 - 1;
			pointer.y = - ( event.clientY / window.innerHeight ) * 2 + 1;

			}
			
            function update()
            {
                stats.update();
				keyboard.update();
				
                sunObject.rotation.y += 0.01;
				mercuryObject.rotation.y += 0.01;
				venusObject.rotation.y += 0.01;
				earthObject.rotation.y += 0.01;

				mercuryObject.position.x =  -(4*Math.sin(renderer.info.render.frame * 0.01));
				mercuryObject.position.z =  -(4*Math.cos(renderer.info.render.frame * 0.01));

				venusObject.position.x =  6*Math.sin(renderer.info.render.frame * 0.003);
				venusObject.position.z =  6*Math.cos(renderer.info.render.frame * 0.003);

				earthObject.position.x =  8*Math.sin(renderer.info.render.frame * 0.001);
				earthObject.position.z =  8*Math.cos(renderer.info.render.frame * 0.001);

				moonObject.position.x =  8.8*Math.sin(renderer.info.render.frame * 0.001);
				moonObject.position.z =  8.8*Math.cos(renderer.info.render.frame * 0.001);
				
				marsObject.position.x =  -(10.8*Math.sin(renderer.info.render.frame * 0.004));
				marsObject.position.z =  -(10.8*Math.cos(renderer.info.render.frame * 0.004));

				jupiterObject.position.x =  -(24.8*Math.sin(renderer.info.render.frame * 0.003));
				jupiterObject.position.z =  -(24.8*Math.cos(renderer.info.render.frame * 0.003));

				saturnoObject.position.x =  -(34.8*Math.sin(renderer.info.render.frame * 0.004));
				saturnoObject.position.z =  -(34.8*Math.cos(renderer.info.render.frame * 0.004));

				anillosObject.position.x =  -(34.8*Math.sin(renderer.info.render.frame * 0.004));
				anillosObject.position.z =  -(34.8*Math.cos(renderer.info.render.frame * 0.004));

				anillosObject2.position.x =  -(34.8*Math.sin(renderer.info.render.frame * 0.004));
				anillosObject2.position.z =  -(34.8*Math.cos(renderer.info.render.frame * 0.004));

				uranoObject.position.x =  38.8*Math.sin(renderer.info.render.frame * 0.004);
				uranoObject.position.z =  38.8*Math.cos(renderer.info.render.frame * 0.004);

				neptunoObject.position.x =  44.8*Math.sin(renderer.info.render.frame * 0.001);
				neptunoObject.position.z =  44.8*Math.cos(renderer.info.render.frame * 0.001);

				group.rotateY(0.001);
				
				updateLight();
				camera.updateMatrixWorld();
				
				raycaster.setFromCamera( pointer, camera );

				const intersects = raycaster.intersectObjects( scene.children);
				
				if ( intersects.length > 0 ) {
					
					if ( INTERSECTED != intersects[ 0 ].object ) {
			
						if ( INTERSECTED ){
							if(INTERSECTED == sunObject)
								INTERSECTED.remove( sunLabel );
							if(INTERSECTED == mercuryObject)
								INTERSECTED.remove( mercuryLabel );
							if(INTERSECTED == venusObject)
								INTERSECTED.remove( venusLabel );
							if(INTERSECTED == earthObject)
								INTERSECTED.remove( earthLabel );
							if(INTERSECTED == moonObject)
								INTERSECTED.remove( moonLabel );
							if(INTERSECTED == marsObject)
								INTERSECTED.remove( marsLabel );
							if(INTERSECTED == jupiterObject)
								INTERSECTED.remove( jupiterLabel );
							if(INTERSECTED == saturnoObject)
								INTERSECTED.remove( saturnoLabel );
							if(INTERSECTED == uranoObject)
								INTERSECTED.remove( uranoLabel );
							if(INTERSECTED == neptunoObject)
								INTERSECTED.remove( neptunoLabel );
						}
							
						
						INTERSECTED = intersects[ 0 ].object;
						if(INTERSECTED == sunObject)
							INTERSECTED.add( sunLabel );
						if(INTERSECTED == mercuryObject)
							INTERSECTED.add( mercuryLabel );
						if(INTERSECTED == venusObject)
							INTERSECTED.add( venusLabel );
						if(INTERSECTED == earthObject)
							INTERSECTED.add( earthLabel );
						if(INTERSECTED == moonObject)
							INTERSECTED.add( moonLabel );
						if(INTERSECTED == marsObject)
							INTERSECTED.add( marsLabel );
						if(INTERSECTED == jupiterObject)
							INTERSECTED.add( jupiterLabel );
						if(INTERSECTED == saturnoObject)
							INTERSECTED.add( saturnoLabel );
						if(INTERSECTED == uranoObject)
							INTERSECTED.add( uranoLabel );
						if(INTERSECTED == neptunoObject)
							INTERSECTED.add( neptunoLabel );
					}

				}
				else {

					if ( INTERSECTED ){
						if(INTERSECTED == sunObject)
							INTERSECTED.remove( sunLabel );
						if(INTERSECTED == mercuryObject)
							INTERSECTED.remove( mercuryLabel );
						if(INTERSECTED == venusObject)
							INTERSECTED.remove( venusLabel );
						if(INTERSECTED == earthObject)
							INTERSECTED.remove( earthLabel );
						if(INTERSECTED == moonObject)
							INTERSECTED.remove( moonLabel );
						if(INTERSECTED == marsObject)
							INTERSECTED.remove( marsLabel );
						if(INTERSECTED == jupiterObject)
							INTERSECTED.remove( jupiterLabel );
						if(INTERSECTED == saturnoObject)
							INTERSECTED.remove( saturnoLabel );
						if(INTERSECTED == uranoObject)
							INTERSECTED.remove( uranoLabel );
						if(INTERSECTED == neptunoObject)
							INTERSECTED.remove( neptunoLabel );
					}
					
					INTERSECTED = null;

				}
				
                let translateSpeed = 4.5; 
                let distance = translateSpeed * deltaTime;
                let rotateSpeed = Math.PI/3; 
                let angle = rotateSpeed * deltaTime;
                
                if (keyboard.isKeyPressed("W"))
                    mainMover.translateZ( -distance );
                if (keyboard.isKeyPressed("S"))
                    mainMover.translateZ( distance );
                    
                if (keyboard.isKeyPressed("A"))
                    mainMover.translateX( -distance );
                if (keyboard.isKeyPressed("D"))
                    mainMover.translateX( distance );
                    
                if (keyboard.isKeyPressed("R"))
                    mainMover.translateY( distance );
                if (keyboard.isKeyPressed("F"))
                    mainMover.translateY( -distance );
                    
                if (keyboard.isKeyPressed("Q"))
                    mainMover.rotateY( angle );
                if (keyboard.isKeyPressed("E"))
                    mainMover.rotateY( -angle );
                    
                if (keyboard.isKeyPressed("T"))
                    mainMover.rotateX( angle );
                if (keyboard.isKeyPressed("G"))
                    mainMover.rotateX( -angle );
                
                
            }
            
			
            
			function onWindowResize() {

				camera.aspect = window.innerWidth / window.innerHeight;
				camera.updateProjectionMatrix();

				renderer.setSize( window.innerWidth, window.innerHeight );
				labelRenderer.setSize( window.innerWidth, window.innerHeight );
			}

			//

			function animate() {
				
				renderer.setAnimationLoop( render );
			}

			function render() {

				
				stats.update();
				deltaTime = clock.getDelta();
				totalTime += deltaTime;
				update();
				
				renderer.render( scene, camera ); 
				labelRenderer.render( scene, camera );  

			}
			
            

		</script>
	</body>
</html>
